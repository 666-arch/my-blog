---
author: Huang Chao
pubDatetime: 2023-03-23T11:18:53Z
modDatetime: 2023-03-24T01:22:56.066Z
title: "关于项目"
featured: true
draft: false
tags:
  - 其他
description: "项目梳理"
---

### 数字人 AI 集成？

> 它主要业务是通过语音指令匹配关键词，然后输出对应的内容，这个输出方式主要是通过浏览器语音播报的方式。

### 科大讯飞语音 API 的流式传输如何实现？

通过 WebSocket 建立长连接，实时传输音频流数据。将音频流切割 `固定大小数据包`（4KB），通过二进制帧（Binary Frame）发送

#### 分包策略

- 前端应该式通过 MediaRecorder API 去录制的音频
- 通过 `ondatavailable` 事件获取数据库按序发送

### 你怎么去二次集成他们的 API 的？

1. 首先，科大讯飞提供的 流式API 需要我们完成接口鉴权，这一步需要提供两个信息

- APIKey
- APISecret
  这两个可以在应用控制台通过创建 WebAPI 应用就可以获取到。

2. 鉴权成功后

检查 `socket` readyState 状态是否处于 `OPEN` 状态，然后通过 讯飞提供的格式发送音频流

- status：检查是否是最后一帧
- format：音频采样率确定
- encoding：音频格式，`raw` 原生音频
- audio：音频内容，将请求参数使用 `base64` 编码

```js
const params = {
  common: {
    app_id: this.APP_ID, // 应用ID，可在讯飞控制台获取
  },
  business: {
    language: "zh_cn", //设置返回的语音语言
    domain: "iat",
    accent: "mandarin", //接收的语音
    vad_eos: 60000, // 静默状态时长(测试最长静默时间为60s)
    dwa: "wpgs",
    ptt: 0, //不要识别标点符号
  },
  data: {
    status: 0,
    format: "audio/L16;rate=16000", //采样率
    encoding: "raw", //原生音频格式
  },
};
this.ws?.send(JSON.stringify(params));
```

3. 获取音频文本

- 科大讯飞返回的是 `多数组单字符` 的数据结构，通过字段 `pgs` 判断是否是文本片段
- 然后通过循环和累加的方式每次获取的都是最新的文本

4. 向外暴露音频文本结果
