---
author: Huang Chao
pubDatetime: 2023-03-23T11:18:53Z
modDatetime: 2023-03-24T01:22:56.066Z
title: "å…³äºŽ JS é‚£äº›äº‹"
featured: true
draft: false
tags:
  - echarts
description: "JSç¢Žç‰‡åŒ–"
---

## æœ‰å…³ null å’Œ undefined çš„åŒºåˆ«

- nullè¡¨ç¤º ä¸€ä¸ªç©ºæŒ‡é’ˆï¼Œå®ƒä¸æŒ‡å‘ä»»ä½•å¯¹è±¡ï¼Œæ˜¯æˆ‘ä»¬ä¸»åŠ¨èµ‹äºˆå˜é‡çš„ä¸€ä¸ªå€¼
- undefined åˆ™è¡¨ç¤ºä½ å£°æ˜Žäº†ä¸€ä¸ªå˜é‡ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰èµ‹å€¼æ“ä½œï¼Œæˆ–è€…è¯´å‡½æ•°æ²¡æœ‰è¿”å›žå€¼çš„æ“ä½œï¼Œéƒ½ä¼šå‡ºçŽ°undefinedçš„æƒ…å†µ

## è°ˆè°ˆé—­åŒ…

### é—­åŒ…çŽ¯å¢ƒå‡ºçŽ°çš„æ¡ä»¶

```js
function x() {
  let count = 0;

  function y() {
    return (count += 1);
  }

  return y;
}

let fun = x();
console.log("count", fun()); // 1
console.log("count", fun()); // 2
```

å®ƒæ˜¯ç”±å¤šä¸ªå‡½æ•°åµŒå¥—å¼•ç”¨ï¼Œå¹¶ä¸”å¤šä¸ªå‡½æ•°ä½œç”¨åŸŸå†…é’ˆå¯¹æŸä¸ªå¤–éƒ¨å˜é‡è¿›è¡Œå†…éƒ¨å¼•ç”¨ï¼Œå¹¶ä¸”åªè¦è¿™ä¸ªå‡½æ•°ä¸é”€æ¯çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªé—­åŒ…ä¸­çš„å˜é‡å°†ä¼šä¸€ç›´å­˜åœ¨

### é—­åŒ…çš„åº”ç”¨

- å‡½æ•°æŸ¯é‡ŒåŒ–
- å®žçŽ°å‡½æ•°æ¨¡å—åŒ–
  - `count` æ˜¯ä¸€ä¸ªåˆ›å»ºäºŽ `fun` å‡½æ•°ä½œç”¨åŸŸå†…çš„å˜é‡
  - é€šè¿‡åœ¨å†…éƒ¨å¤„ç† `count` çš„è¯»å–å’Œè®¾ç½®ï¼Œå¤–éƒ¨æ— æ³•ç›´æŽ¥è°ƒç”¨åˆ° count
  - é€šè¿‡æš´éœ²å…¬å…±æ–¹æ³•åŽ»ä¾›å¤–éƒ¨è¯»å–

```js
function fun() {
  let count = 0;
  return {
    get() {
      return count; // ç§æœ‰å˜é‡ï¼Œå¤–éƒ¨æ— æ³•è®¿é—®
    },
    set() {
      count += 1;
    },
  };
}

let newFun = fun();
newFun.set();
console.log("result", newFun.get());
```

### æ³¨æ„äº‹é¡¹

> å¦‚æžœé—­åŒ…é•¿æœŸå­˜åœ¨ï¼Œä¼šå®¹æ˜“å¯¼è‡´å†…å­˜æ³„éœ²ï¼Œå¤–éƒ¨å˜é‡ä¼šè¢«æ°¸è¿œæºå¸¦ï¼Œå¯ä»¥é€šè¿‡èµ‹å€¼ null çš„æ–¹å¼ é‡Šæ”¾é—­åŒ…

## JS ä¸­çš„å¼‚æ­¥ç¼–ç¨‹

> JS æœ¬èº«æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„ï¼Œç›¸å½“äºŽæ¯æ¬¡æ‰§è¡Œä¸€ä¸ª `task` éƒ½æ˜¯ä¸€ä¸ªä¸ªæ‰§è¡Œï¼Œä¸ºäº†å¤„ç†å¼‚æ­¥æ“ä½œï¼ŒJS å¼•å…¥äº†äº‹ä»¶å¾ªçŽ¯ï¼ˆevent loopï¼‰

### å…³äºŽäº‹ä»¶å¾ªçŽ¯ event loop

äº‹ä»¶å¾ªçŽ¯æ˜¯ä¸æ–­çš„ä»Žæ–°çš„ä»»åŠ¡ä¸­å–å‡ºä»»åŠ¡å¹¶æ‰§è¡Œã€‚å¹¶ä¸”ä»»åŠ¡é˜Ÿåˆ—åˆ†ä¸ºå®ä»»åŠ¡é˜Ÿåˆ—å’Œå¾®ä»»åŠ¡é˜Ÿåˆ—

> å¾®ä»»åŠ¡é˜Ÿåˆ—ä¼˜å…ˆçº§é«˜äºŽå®ä»»åŠ¡é˜Ÿåˆ—

åœºæ™¯è®¾å®šðŸ”

æƒ³è±¡ä½ è¿›å…¥ä¸€ä¸ªå¿«é¤åº—ï¼ˆæµè§ˆå™¨ï¼‰ï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ªåŽ¨å¸ˆï¼ˆJSä¸»çº¿ç¨‹ï¼‰ï¼Œä½†æ˜¯é¡¾å®¢ï¼ˆtaskï¼‰å´å¾ˆå¤šã€‚è¿™ä¸ªæ—¶å€™ JS å¼•å…¥äº†ä¸€å¥—é«˜æ•ˆçš„æŽ’é˜Ÿç³»ç»Ÿ

1. åŒæ­¥ä»»åŠ¡

ä»»åŠ¡ä¸€ä¸ªä¸€ä¸ªæ‰§è¡Œï¼Œæ‰§è¡Œå®Œä¸€ä¸ªæ‰§è¡Œä¸‹ä¸€ä¸ª

```js
console.log("ç‚¹æ±‰å ¡");
console.log("ç‚¹è–¯æ¡");
```

2. å¼‚æ­¥ä»»åŠ¡

å®ä»»åŠ¡ï¼š

å¼€è®¾ä¸€ä¸ªæ–°çš„çª—å£ï¼ˆå¤–å–çª—å£ï¼‰é€šè¿‡ `WebAPI` è¿›è¡Œè®¡æ—¶

```js
setTimeout(() => {
  console.log("å¤–å–");
}, 0);
```

- åŽ¨å¸ˆè¿˜æ˜¯ä¼šä¼˜å…ˆå¤„ç†åŒæ­¥ä»»åŠ¡
- åŒæ­¥ä»»åŠ¡å…¨éƒ¨å¤„ç†å®Œæˆï¼Œå¤„ç†å¤–å–ä»»åŠ¡
- å¤–å–ä»»åŠ¡å®Œæˆï¼Œæ·»åŠ åˆ°å¤–å–é˜Ÿåˆ—

å¾®ä»»åŠ¡ï¼š

å¼€è®¾ä¸€ä¸ªè®¢å•åŠ æ€¥çª—å£ï¼Œå¤„ç†åŠ æ€¥è®¢å•ï¼ˆä»»åŠ¡ï¼‰

```js
Promise.resolve().then(() => {
  console.log("åŠ æ€¥è®¢å•");
});
```

- æŠŠå®Œæˆçš„è®¢å•ï¼ˆä»»åŠ¡ï¼‰æ”¾è¿›åŠ æ€¥è®¢å•ä¸­
- å½“åŽ¨å¸ˆæŠŠæ‰‹å¤´ä»»åŠ¡ï¼ˆåŒæ­¥ï¼‰å…¨éƒ¨å®Œæˆï¼Œå†å¤„ç†åŠ æ€¥è®¢å•ï¼Œå“ªæ€•å¤–å–çª—å£æœ‰å…¶ä»–è®¢å•ç­‰å¾…ï¼

æ‰§è¡Œæµç¨‹ï¼š

- åŽ¨å¸ˆä¼šä¼˜å…ˆå¤„ç†åŒæ­¥ä»»åŠ¡ä¸­çš„æ‰€æœ‰ä»»åŠ¡
- æ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰æ–°çš„ä»»åŠ¡ï¼Œç­‰åŒæ­¥å¤„ç†å®Œä¼˜å…ˆå¤„ç†
- æ£€æŸ¥å®ä»»åŠ¡é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰æ–°çš„ä»»åŠ¡ï¼Œå¦‚æžœæœ‰ï¼Œåªå¤„ç†ä¸€ä¸ª
- å¾ªçŽ¯å¾€å¤ï¼Œç›´åˆ°é˜Ÿåˆ—ä»»åŠ¡å…¨éƒ¨æ¸…ç©º

## JS å¦‚ä½•æž„é€ ä¸€ä¸ªä¸€ç™¾ä¸ªå…¨ä¸º 0 çš„æ•°ç»„

- é€šè¿‡ Array.fill
  > ç”¨äºŽå¡«å……ä¸€ä¸ªå›ºå®šå€¼åˆ°æ•°ç»„ä¸­ï¼Œä»Žèµ·å§‹ç´¢å¼•åˆ°ç»ˆæ­¢ç´¢å¼•

```js
new Array(100).fill(0);
```

## ES6ä¸­å¿…é¡»è¦çŸ¥é“çš„ï¼Ÿ

### letã€constã€var åŒºåˆ«ï¼Ÿ

- var çš„å˜é‡æå‡

é¦–å…ˆ è¿™ä¸‰ä¸ªéƒ½æ˜¯å¯ä»¥åŽ»å®šä¹‰ä¸€ä¸ªä»»æ„ç±»åž‹çš„å˜é‡
`var` å…¶å®žæ˜¯ Javascript çš„ä¸€ä¸ª `bug`ï¼Œåœ¨å®šä¹‰å˜é‡æ—¶ï¼Œå¯ä»¥åœ¨ä¸åˆå§‹åŒ–èµ‹å€¼çš„æƒ…å†µä¸‹ç›´æŽ¥ä½¿ç”¨å¹¶ä¸”æµè§ˆå™¨åªä¼šè­¦å‘Šå¯èƒ½å­˜åœ¨ undefined
æƒ…å†µï¼Œä¸ä¼šç›´æŽ¥å‘ŠçŸ¥å¼€å‘è€…å¹¶ä¸”æŠ›å‡ºå¼‚å¸¸
è¿™å°±æ˜¯ `å˜é‡æå‡`

```js
console.log(a); // undefined
var a = 10;
```

- var å­˜åœ¨ `å‡½æ•°ä½œç”¨åŸŸ` æˆ–è€… `å…¨å±€ä½œç”¨åŸŸ`

`if` å—å¤–éƒ¨ ä»ç„¶å¯ä»¥è®¿é—® x å˜é‡ï¼Œæ˜¾ç„¶ä¸å¦¥ã€‚

```js
function fun() {
  if (true) {
    var x = 10;
  }
  console.log(x); // 10
}

fun();
```

- `let`ï¼Œ`const` å®ƒä»¬éƒ½å…·æœ‰ `å—çº§ä½œç”¨åŸŸ`ã€‚

ä¸€ä¸ªæ˜¯ä½œä¸ºå˜é‡å­˜å‚¨ã€ä¸€ä¸ªæ˜¯ä½œä¸ºå¸¸é‡å­˜å‚¨ï¼Œä»–ä»¬çš„å‡ºçŽ°å°±æ˜¯ä¸ºäº†è§£å†³ `var` å¸¦æ¥ bug

æ‰€è°“å˜é‡ å°±æ˜¯åœ¨è¿›è¡Œåˆå§‹åŒ–èµ‹å€¼åŽï¼Œå¯ä»¥å˜åŒ–ä¿®æ”¹çš„å€¼

æ‰€è°“å¸¸é‡ å°±æ˜¯ä¸€æ—¦å®Œæˆåˆå§‹åŒ–èµ‹å€¼åŽï¼Œæ— æ³•è½»æ˜“çš„ä¿®æ”¹å€¼ï¼ˆä½†å­˜åœ¨ç‰¹æ®Šæƒ…å†µï¼‰

```js
function fun() {
  if (true) {
    const x = 10;
    let y = 20;
  }
  console.log(x); // æŠ¥é”™ï¼šx is not defined
  console.log(y); // æŠ¥é”™ï¼šy is not defined
}

fun();
```

### ç®­å¤´å‡½æ•°æ‡‚å—ï¼Ÿ

1. ç‰¹æ€§

ç®­å¤´å‡½æ•°æ— éœ€é€šè¿‡ `function` åŽ»å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œé€šè¿‡æ‹¬å· + è¡¨è¾¾å¼çš„å½¢å¼åŽ»å®šä¹‰
è¯­æ³•æ˜¯ï¼šå½“å‚æ•°åªæœ‰ä¸€ä¸ªæ—¶ï¼Œå¯ä»¥çœç•¥æ‹¬å·ï¼Œå½“è¡¨è¾¾å¼ä¹Ÿæ˜¯å•ä¸ªæ—¶å¯ä»¥éšå¼çš„è¿”å›ž

å³ï¼š

```js
const fun = (a, b) => {
  a + b;
};
```

2. ä¸å­˜åœ¨ `this` æŒ‡å‘çš„é—®é¢˜

- ç®­å¤´å‡½æ•°è‡ªåŠ¨ç»§æ‰¿å¤–å±‚ä½œç”¨åŸŸï¼ˆé™æ€ç»‘å®šï¼‰

è¿™ä½¿å¾—ç®­å¤´å‡½æ•°åœ¨å›žè°ƒå‡½æ•°æ¯”å¦‚ï¼ˆsetTimeout æˆ–è€… reactäº‹ä»¶å¤„ç†ï¼‰ä¸­éžå¸¸æœ‰ç”¨

```js
function timer() {
  this.seconds = 0;
  //ä¼ ç»Ÿå‡½æ•°ä¸‹ï¼šthisæŒ‡å‘çš„æ˜¯è°ƒç”¨è€…ï¼ˆå¯èƒ½å‡ºçŽ°thisä¸¢å¤±ï¼‰
  setTimeout(function a() {
    this.seconds++;
  }, 1000);
  //ç®­å¤´å‡½æ•°ä¸‹ï¼šthisç›´æŽ¥ç»§æ‰¿å¤–éƒ¨å‡½æ•°çš„å®žä¾‹
  setTimeout(() => {
    this.seconds++;
  }, 1000);
}
```

- é¿å…äº†åœ¨ `setTimeout`ã€äº‹ä»¶å¤„ç†å‡½æ•°ã€æˆ–è€…æ•°ç»„æ–¹æ³•ä¸­ this çš„æŒ‡å‘é—®é¢˜

```js
// æ™®é€šå‡½æ•°éœ€è¦é¢å¤–é€šè¿‡ bind ç»‘å®šthis
button
  .addListener("click", function () {
    this.classList.toggle("active");
  })
  .bind(this);

//ç®­å¤´å‡½æ•° è‡ªåŠ¨ç»§æ‰¿å¤–å±‚å‡½æ•°ç¤ºä¾‹
button.addListener("click", () => {
  this.classList.toggle("active");
});
```

- æ²¡æœ‰åŽŸåž‹å±žæ€§ï¼ˆprototypeï¼‰ï¼Œæ‰€ä»¥æ— æ³•ä½œä¸ºå¯¹è±¡çš„è‡ªèº«å±žæ€§åŽ»è®¿é—®

```js
const obj = {
  a: 1,
  b: () => this.a, //é”™è¯¯ã€‚ï¼Œæ­¤æ—¶ this æŒ‡å‘å…¨å±€å¯¹è±¡
};
```

- ç®­å¤´å‡½æ•°ç¬¦åˆå‡½æ•°å¼ç¼–ç¨‹çš„é£Žæ ¼ï¼Œæé«˜ä»£ç å¯è¯»æ€§ï¼Œç»´æŠ¤æ€§

ç®€åŒ–åƒ `map`ã€`filter`ã€`reduce`ç­‰é’ˆå¯¹æ•°ç»„çš„ä¸€äº›æ“ä½œ

```js
const nums = [1, 2, 3];
const squera = nums.map(x => x * x);
```
