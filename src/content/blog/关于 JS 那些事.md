---
author: Huang Chao
pubDatetime: 2023-03-23T11:18:53Z
modDatetime: 2023-03-24T01:22:56.066Z
title: "å…³äº JS é‚£äº›äº‹"
featured: true
draft: false
tags:
  - Javascript
description: "JSç¢ç‰‡åŒ–"
---

## æœ‰å…³ null å’Œ undefined çš„åŒºåˆ«

- nullè¡¨ç¤º ä¸€ä¸ªç©ºæŒ‡é’ˆï¼Œå®ƒä¸æŒ‡å‘ä»»ä½•å¯¹è±¡ï¼Œæ˜¯æˆ‘ä»¬ä¸»åŠ¨èµ‹äºˆå˜é‡çš„ä¸€ä¸ªå€¼
- undefined åˆ™è¡¨ç¤ºä½ å£°æ˜äº†ä¸€ä¸ªå˜é‡ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰èµ‹å€¼æ“ä½œï¼Œæˆ–è€…è¯´å‡½æ•°æ²¡æœ‰è¿”å›å€¼çš„æ“ä½œï¼Œéƒ½ä¼šå‡ºç°undefinedçš„æƒ…å†µ

## è°ˆè°ˆé—­åŒ…

### é—­åŒ…ç¯å¢ƒå‡ºç°çš„æ¡ä»¶

```js
function x() {
  let count = 0;

  function y() {
    return (count += 1);
  }

  return y;
}

let fun = x();
console.log("count", fun()); // 1
console.log("count", fun()); // 2
```

å®ƒæ˜¯ç”±å¤šä¸ªå‡½æ•°åµŒå¥—å¼•ç”¨ï¼Œå¹¶ä¸”å¤šä¸ªå‡½æ•°ä½œç”¨åŸŸå†…é’ˆå¯¹æŸä¸ªå¤–éƒ¨å˜é‡è¿›è¡Œå†…éƒ¨å¼•ç”¨ï¼Œå¹¶ä¸”åªè¦è¿™ä¸ªå‡½æ•°ä¸é”€æ¯çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªé—­åŒ…ä¸­çš„å˜é‡å°†ä¼šä¸€ç›´å­˜åœ¨

### é—­åŒ…çš„åº”ç”¨

- å‡½æ•°æŸ¯é‡ŒåŒ–
- å®ç°å‡½æ•°æ¨¡å—åŒ–
  - `count` æ˜¯ä¸€ä¸ªåˆ›å»ºäº `fun` å‡½æ•°ä½œç”¨åŸŸå†…çš„å˜é‡
  - é€šè¿‡åœ¨å†…éƒ¨å¤„ç† `count` çš„è¯»å–å’Œè®¾ç½®ï¼Œå¤–éƒ¨æ— æ³•ç›´æ¥è°ƒç”¨åˆ° count
  - é€šè¿‡æš´éœ²å…¬å…±æ–¹æ³•å»ä¾›å¤–éƒ¨è¯»å–

```js
function fun() {
  let count = 0;
  return {
    get() {
      return count; // ç§æœ‰å˜é‡ï¼Œå¤–éƒ¨æ— æ³•è®¿é—®
    },
    set() {
      count += 1;
    },
  };
}

let newFun = fun();
newFun.set();
console.log("result", newFun.get());
```

### æ³¨æ„äº‹é¡¹

> å¦‚æœé—­åŒ…é•¿æœŸå­˜åœ¨ï¼Œä¼šå®¹æ˜“å¯¼è‡´å†…å­˜æ³„éœ²ï¼Œå¤–éƒ¨å˜é‡ä¼šè¢«æ°¸è¿œæºå¸¦ï¼Œå¯ä»¥é€šè¿‡èµ‹å€¼ null çš„æ–¹å¼ é‡Šæ”¾é—­åŒ…

## JS ä¸­çš„å¼‚æ­¥ç¼–ç¨‹

> JS æœ¬èº«æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„ï¼Œç›¸å½“äºæ¯æ¬¡æ‰§è¡Œä¸€ä¸ª `task` éƒ½æ˜¯ä¸€ä¸ªä¸ªæ‰§è¡Œï¼Œä¸ºäº†å¤„ç†å¼‚æ­¥æ“ä½œï¼ŒJS å¼•å…¥äº†äº‹ä»¶å¾ªç¯ï¼ˆevent loopï¼‰

### å…³äºäº‹ä»¶å¾ªç¯ event loop

äº‹ä»¶å¾ªç¯æ˜¯ä¸æ–­çš„ä»æ–°çš„ä»»åŠ¡ä¸­å–å‡ºä»»åŠ¡å¹¶æ‰§è¡Œã€‚å¹¶ä¸”ä»»åŠ¡é˜Ÿåˆ—åˆ†ä¸ºå®ä»»åŠ¡é˜Ÿåˆ—å’Œå¾®ä»»åŠ¡é˜Ÿåˆ—

> å¾®ä»»åŠ¡é˜Ÿåˆ—ä¼˜å…ˆçº§é«˜äºå®ä»»åŠ¡é˜Ÿåˆ—

åœºæ™¯è®¾å®šğŸ”

æƒ³è±¡ä½ è¿›å…¥ä¸€ä¸ªå¿«é¤åº—ï¼ˆæµè§ˆå™¨ï¼‰ï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ªå¨å¸ˆï¼ˆJSä¸»çº¿ç¨‹ï¼‰ï¼Œä½†æ˜¯é¡¾å®¢ï¼ˆtaskï¼‰å´å¾ˆå¤šã€‚è¿™ä¸ªæ—¶å€™ JS å¼•å…¥äº†ä¸€å¥—é«˜æ•ˆçš„æ’é˜Ÿç³»ç»Ÿ

1. åŒæ­¥ä»»åŠ¡

ä»»åŠ¡ä¸€ä¸ªä¸€ä¸ªæ‰§è¡Œï¼Œæ‰§è¡Œå®Œä¸€ä¸ªæ‰§è¡Œä¸‹ä¸€ä¸ª

```js
console.log("ç‚¹æ±‰å ¡");
console.log("ç‚¹è–¯æ¡");
```

2. å¼‚æ­¥ä»»åŠ¡

å®ä»»åŠ¡ï¼š

å¼€è®¾ä¸€ä¸ªæ–°çš„çª—å£ï¼ˆå¤–å–çª—å£ï¼‰é€šè¿‡ `WebAPI` è¿›è¡Œè®¡æ—¶

```js
setTimeout(() => {
  console.log("å¤–å–");
}, 0);
```

- å¨å¸ˆè¿˜æ˜¯ä¼šä¼˜å…ˆå¤„ç†åŒæ­¥ä»»åŠ¡
- åŒæ­¥ä»»åŠ¡å…¨éƒ¨å¤„ç†å®Œæˆï¼Œå¤„ç†å¤–å–ä»»åŠ¡
- å¤–å–ä»»åŠ¡å®Œæˆï¼Œæ·»åŠ åˆ°å¤–å–é˜Ÿåˆ—

å¾®ä»»åŠ¡ï¼š

å¼€è®¾ä¸€ä¸ªè®¢å•åŠ æ€¥çª—å£ï¼Œå¤„ç†åŠ æ€¥è®¢å•ï¼ˆä»»åŠ¡ï¼‰

```js
Promise.resolve().then(() => {
  console.log("åŠ æ€¥è®¢å•");
});
```

- æŠŠå®Œæˆçš„è®¢å•ï¼ˆä»»åŠ¡ï¼‰æ”¾è¿›åŠ æ€¥è®¢å•ä¸­
- å½“å¨å¸ˆæŠŠæ‰‹å¤´ä»»åŠ¡ï¼ˆåŒæ­¥ï¼‰å…¨éƒ¨å®Œæˆï¼Œå†å¤„ç†åŠ æ€¥è®¢å•ï¼Œå“ªæ€•å¤–å–çª—å£æœ‰å…¶ä»–è®¢å•ç­‰å¾…ï¼

æ‰§è¡Œæµç¨‹ï¼š

- å¨å¸ˆä¼šä¼˜å…ˆå¤„ç†åŒæ­¥ä»»åŠ¡ä¸­çš„æ‰€æœ‰ä»»åŠ¡
- æ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰æ–°çš„ä»»åŠ¡ï¼Œç­‰åŒæ­¥å¤„ç†å®Œä¼˜å…ˆå¤„ç†
- æ£€æŸ¥å®ä»»åŠ¡é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰æ–°çš„ä»»åŠ¡ï¼Œå¦‚æœæœ‰ï¼Œåªå¤„ç†ä¸€ä¸ª
- å¾ªç¯å¾€å¤ï¼Œç›´åˆ°é˜Ÿåˆ—ä»»åŠ¡å…¨éƒ¨æ¸…ç©º

## JS å¦‚ä½•æ„é€ ä¸€ä¸ªä¸€ç™¾ä¸ªå…¨ä¸º 0 çš„æ•°ç»„

- é€šè¿‡ Array.fill
  > ç”¨äºå¡«å……ä¸€ä¸ªå›ºå®šå€¼åˆ°æ•°ç»„ä¸­ï¼Œä»èµ·å§‹ç´¢å¼•åˆ°ç»ˆæ­¢ç´¢å¼•

```js
new Array(100).fill(0);
```

## ES6ä¸­å¿…é¡»è¦çŸ¥é“çš„ï¼Ÿ

### letã€constã€var åŒºåˆ«ï¼Ÿ

- var çš„å˜é‡æå‡

é¦–å…ˆ è¿™ä¸‰ä¸ªéƒ½æ˜¯å¯ä»¥å»å®šä¹‰ä¸€ä¸ªä»»æ„ç±»å‹çš„å˜é‡
`var` å…¶å®æ˜¯ Javascript çš„ä¸€ä¸ª `bug`ï¼Œåœ¨å®šä¹‰å˜é‡æ—¶ï¼Œå¯ä»¥åœ¨ä¸åˆå§‹åŒ–èµ‹å€¼çš„æƒ…å†µä¸‹ç›´æ¥ä½¿ç”¨å¹¶ä¸”æµè§ˆå™¨åªä¼šè­¦å‘Šå¯èƒ½å­˜åœ¨ undefined
æƒ…å†µï¼Œä¸ä¼šç›´æ¥å‘ŠçŸ¥å¼€å‘è€…å¹¶ä¸”æŠ›å‡ºå¼‚å¸¸
è¿™å°±æ˜¯ `å˜é‡æå‡`

```js
console.log(a); // undefined
var a = 10;
```

- var å­˜åœ¨ `å‡½æ•°ä½œç”¨åŸŸ` æˆ–è€… `å…¨å±€ä½œç”¨åŸŸ`

`if` å—å¤–éƒ¨ ä»ç„¶å¯ä»¥è®¿é—® x å˜é‡ï¼Œæ˜¾ç„¶ä¸å¦¥ã€‚

```js
function fun() {
  if (true) {
    var x = 10;
  }
  console.log(x); // 10
}

fun();
```

- `let`ï¼Œ`const` å®ƒä»¬éƒ½å…·æœ‰ `å—çº§ä½œç”¨åŸŸ`ã€‚

ä¸€ä¸ªæ˜¯ä½œä¸ºå˜é‡å­˜å‚¨ã€ä¸€ä¸ªæ˜¯ä½œä¸ºå¸¸é‡å­˜å‚¨ï¼Œä»–ä»¬çš„å‡ºç°å°±æ˜¯ä¸ºäº†è§£å†³ `var` å¸¦æ¥ bug

æ‰€è°“å˜é‡ å°±æ˜¯åœ¨è¿›è¡Œåˆå§‹åŒ–èµ‹å€¼åï¼Œå¯ä»¥å˜åŒ–ä¿®æ”¹çš„å€¼

æ‰€è°“å¸¸é‡ å°±æ˜¯ä¸€æ—¦å®Œæˆåˆå§‹åŒ–èµ‹å€¼åï¼Œæ— æ³•è½»æ˜“çš„ä¿®æ”¹å€¼ï¼ˆä½†å­˜åœ¨ç‰¹æ®Šæƒ…å†µï¼‰

```js
function fun() {
  if (true) {
    const x = 10;
    let y = 20;
  }
  console.log(x); // æŠ¥é”™ï¼šx is not defined
  console.log(y); // æŠ¥é”™ï¼šy is not defined
}

fun();
```

### ç®­å¤´å‡½æ•°æ‡‚å—ï¼Ÿ

1. ç‰¹æ€§

ç®­å¤´å‡½æ•°æ— éœ€é€šè¿‡ `function` å»å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œé€šè¿‡æ‹¬å· + è¡¨è¾¾å¼çš„å½¢å¼å»å®šä¹‰
è¯­æ³•æ˜¯ï¼šå½“å‚æ•°åªæœ‰ä¸€ä¸ªæ—¶ï¼Œå¯ä»¥çœç•¥æ‹¬å·ï¼Œå½“è¡¨è¾¾å¼ä¹Ÿæ˜¯å•ä¸ªæ—¶å¯ä»¥éšå¼çš„è¿”å›

å³ï¼š

```js
const fun = (a, b) => {
  a + b;
};
```

2. ä¸å­˜åœ¨ `this` æŒ‡å‘çš„é—®é¢˜

- ç®­å¤´å‡½æ•°è‡ªåŠ¨ç»§æ‰¿å¤–å±‚ä½œç”¨åŸŸï¼ˆé™æ€ç»‘å®šï¼‰

è¿™ä½¿å¾—ç®­å¤´å‡½æ•°åœ¨å›è°ƒå‡½æ•°æ¯”å¦‚ï¼ˆsetTimeout æˆ–è€… reactäº‹ä»¶å¤„ç†ï¼‰ä¸­éå¸¸æœ‰ç”¨

```js
function timer() {
  this.seconds = 0;
  //ä¼ ç»Ÿå‡½æ•°ä¸‹ï¼šthisæŒ‡å‘çš„æ˜¯è°ƒç”¨è€…ï¼ˆå¯èƒ½å‡ºç°thisä¸¢å¤±ï¼‰
  setTimeout(function a() {
    this.seconds++;
  }, 1000);
  //ç®­å¤´å‡½æ•°ä¸‹ï¼šthisç›´æ¥ç»§æ‰¿å¤–éƒ¨å‡½æ•°çš„å®ä¾‹
  setTimeout(() => {
    this.seconds++;
  }, 1000);
}
```

- é¿å…äº†åœ¨ `setTimeout`ã€äº‹ä»¶å¤„ç†å‡½æ•°ã€æˆ–è€…æ•°ç»„æ–¹æ³•ä¸­ this çš„æŒ‡å‘é—®é¢˜

```js
// æ™®é€šå‡½æ•°éœ€è¦é¢å¤–é€šè¿‡ bind ç»‘å®šthis
button
  .addListener("click", function () {
    this.classList.toggle("active");
  })
  .bind(this);

//ç®­å¤´å‡½æ•° è‡ªåŠ¨ç»§æ‰¿å¤–å±‚å‡½æ•°ç¤ºä¾‹
button.addListener("click", () => {
  this.classList.toggle("active");
});
```

- æ²¡æœ‰åŸå‹å±æ€§ï¼ˆprototypeï¼‰ï¼Œæ‰€ä»¥æ— æ³•ä½œä¸ºå¯¹è±¡çš„è‡ªèº«å±æ€§å»è®¿é—®

```js
const obj = {
  a: 1,
  b: () => this.a, //é”™è¯¯ã€‚ï¼Œæ­¤æ—¶ this æŒ‡å‘å…¨å±€å¯¹è±¡
};
```

- ç®­å¤´å‡½æ•°ç¬¦åˆå‡½æ•°å¼ç¼–ç¨‹çš„é£æ ¼ï¼Œæé«˜ä»£ç å¯è¯»æ€§ï¼Œç»´æŠ¤æ€§

ç®€åŒ–åƒ `map`ã€`filter`ã€`reduce`ç­‰é’ˆå¯¹æ•°ç»„çš„ä¸€äº›æ“ä½œ

```js
const nums = [1, 2, 3];
const squera = nums.map(x => x * x);
```

### JSçš„é˜²æŠ–å’ŒèŠ‚æµï¼Ÿ

é˜²æŠ–ï¼šdebounce(f, wait)

> é¿å…é¢‘ç¹çš„é’ˆå¯¹æŸä¸€äº‹ä»¶æµè¿›è¡Œå¤šæ¬¡é¢‘ç¹çš„è§¦å‘ï¼Œä¹Ÿå°±æ˜¯åªè®¾ç½®åœ¨å•ä½æ—¶é—´å†…åªæœ‰æ•ˆè§¦å‘æœ€åä¸€æ¬¡

- åº”ç”¨åœºæ™¯ï¼š
  - ç”¨æˆ·ç™»å½•ï¼Œé¢‘ç¹çš„ç‚¹å‡»ç™»å½•æŒ‰é’®
  - ç”¨æˆ·å‘é€çŸ­ä¿¡ï¼Œå‘é€å¤ªå¤šçš„è¯·æ±‚
  - è°ƒæ•´æµè§ˆå™¨çª—å£ä¼šé€ æˆ resize é¢‘ç¹è®¡ç®—è¿‡å¤š
  - æ–‡æœ¬ç¼–è¾‘å™¨çš„å®æ—¶ä¿å­˜ï¼Œåªä¿å­˜æœ‰æ•ˆçš„æœ€åä¸€æ¬¡è§¦å‘
- é˜²æŠ–æ ¸å¿ƒ
  - åœ¨äº `clearTimeout(timer)` çš„æ¸…é›¶

ä¸¾ä¾‹è¯´æ˜ï¼š

åç”µæ¢¯æ—¶ï¼Œæ¯”å¦‚æŒ‰ä¸‹å…³é—¨æŒ‰é’® åˆ° å…³é—­å®Œæˆ è¿™ä¸€æ—¶é—´ä¸º `3s`ï¼Œå¦‚æœåœ¨è¿™ `3s` å†…å¤–é¢è¿˜æœ‰äººæŒ‰å¼€é—¨æŒ‰é’®ï¼Œé‚£æ­¤æ¬¡çš„å…³é—¨æŒ‰é’®ä¸ä½œä¸ºè§¦å‘çš„æ‰§è¡Œäº‹ä»¶ï¼Œå¹¶ä¸”é‡æ–°å¼€å§‹è®¡æ—¶ã€‚
ä»¥æ­¤ç±»æ¨ï¼Œåªè¦å•ä½æ—¶é—´å†…ä¸€äººæœ‰å¼€é—¨ï¼Œéƒ½ä¸æš‚æ—¶ä½œä¸ºæœ€åä¸€æ¬¡äº‹ä»¶æ‰§è¡Œã€‚åªæœ‰é—¨çœŸæ­£å…³é—­ï¼Œé‚£ä¹ˆæœ€åä¸€æ¬¡çš„äº‹ä»¶æ‰ä¼šä½œä¸ºæ‰§è¡Œäº‹ä»¶è§¦å‘ã€‚

èŠ‚æµï¼šthrottle(f, wait)

> ä¹Ÿæ˜¯æ§åˆ¶äº‹ä»¶å‘ç”Ÿçš„é¢‘ç‡ï¼Œæ¯”å¦‚æ§åˆ¶ 1s å‘ç”Ÿä¸€æ¬¡ï¼Œç”šè‡³æ˜¯ 1åˆ†é’Ÿ å‘ç”Ÿä¸€æ¬¡

- åº”ç”¨åœºæ™¯
  - scroll æ»šåŠ¨äº‹ä»¶ï¼Œæ¯éš” 1s å°±é‡æ–°è®°å½•ä¸€æ¬¡ä½ç½®ä¿¡æ¯
  - æµè§ˆå™¨çš„æ’­æ”¾äº‹ä»¶ï¼Œæ¯éš” 1s å°±é‡æ–°è®°å½•æ’­æ”¾çš„ä¸€ä¸ªè¿›åº¦ä¿¡æ¯
  - input æœç´¢æ¡†ï¼Œå‘é€è¯·æ±‚ä¸‹æ‹‰åˆ—è¡¨
- èŠ‚æµæ ¸å¿ƒ
  - åœ¨äº åŠ é”å’Œé‡ç½®é” `timer=setTimeout`ã€`timer = null`

ä¸¾ä¾‹è¯´æ˜ï¼šèŠ‚æµå¯ä»¥æ¯”ä½œç­‰çº¢ç»¿ç¯ï¼Œå½“ç»¿ç¯è§¦å‘åˆ°å¼€å¯çº¢ç¯è¿™æ®µäº‹ä»¶ï¼Œå¯ä»¥ä¸€æ¬¡é€šè¿‡ä¸€æ‰¹è½¦è¾†

### JS ç±»æ•°ç»„è½¬æ¢æ•°ç»„ï¼Ÿ

ä»€ä¹ˆæ˜¯ç±»æ•°ç»„ï¼Ÿ

> ä¸€ä¸ªå¯¹è±¡æœ‰ length å±æ€§ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç´¢å¼•è®¿é—®å…ƒç´ ï¼Œä½†æ˜¯ä¸å…·å¤‡çº¯æ•°ç»„çš„æ–¹æ³•

- `Array.from`

æœ€ç›´æ¥çš„æ–¹æ³•å°±æ˜¯é€šè¿‡ `Array.from` çš„æ–¹å¼è¿›è¡Œè½¬æ¢

```js
const objToArray = {
  0: "apple",
  1: "orange",
  length: 2,
};
const arr = Array.from(objToArray);
// ['apple', 'orange']
```

- `Array.prototype.slice.call`

é€šè¿‡æ•°ç»„åŸå‹ `Array.prototype.slice.call`

```js
const objToArray = {
  0: "red",
  1: "blue",
  length: 2,
};
const arr = Array.prototype.slice.call(objToArray);
// ['red', 'blue']
```

### åŸå‹å’ŒåŸå‹é“¾ï¼Ÿ

> åœ¨ JS ä¸­ä¸‡ç‰©çš†å¯ä»¥æ˜¯å¯¹è±¡ï¼Œé‚£ä¹ˆå‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼ŒåŸå‹ä¹Ÿæ˜¯å¯¹è±¡ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½å­˜åœ¨ _proto_ å±æ€§ï¼Œè€Œå‡½æ•°æ‹¥æœ‰ç‰¹æ®Šçš„ prototype å±æ€§

åŸå‹é“¾çš„æœ¬è´¨ï¼š

æœ¬è´¨å…¶å®å°±æ˜¯é€šè¿‡ `_proto_` å±æ€§åƒæ¢¯å­ä¸€æ ·é€çº§çš„å‘ä¸ŠæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°å±æ€§æˆ–è€… `null`ï¼ˆæœ€é¡¶å±‚çš„åŸå‹ï¼ŒåŸå‹é“¾ç»ˆç‚¹ï¼‰

åŸå‹å’ŒåŸå‹é“¾ä¹‹é—´å°±è¡Œ `DNAæ¨¡å‹` æ„é€ å‡½æ•°çš„ `prototype` å±æ€§å°±åƒåŸºå› åº“ï¼Œ`_proto_` å°±åƒç»§æ‰¿åŸºå› 

åœ¨ JS `OOP` é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³ä¸­ï¼Œæœ¬è´¨å°±æ˜¯é€šè¿‡åŸå‹å§”æ‰˜æœºåˆ¶ï¼Œå®ƒä¸æ˜¯å¤åˆ¶å„å¯¹è±¡çš„å±æ€§ï¼Œè€Œæ˜¯é€šè¿‡é“¾æ¡çš„å½¢å¼å»ºç«‹å„å¯¹è±¡ç›´æ¥çš„å¼•ç”¨è¿æ¥ã€‚

åº”ç”¨åœºæ™¯ï¼š

- å¯ä»¥å®ç°æ–¹æ³•ç»§æ‰¿ï¼Œé€šè¿‡ ç±» å’Œå®ä¾‹å¯¹è±¡çš„ç»§æ‰¿å…³ç³»ï¼Œè®¿é—®å…¶å†…éƒ¨è¢«å…¬å¼€çš„æ–¹æ³•

### æµ…æ‹·è´ å’Œ æ·±æ‹·è´ï¼Ÿ

é¦–å…ˆæµ…æ‹·è´å’Œæ·±æ‹·è´éƒ½æ˜¯é’ˆå¯¹å¯¹è±¡è¿›è¡Œçš„å¤åˆ¶ï¼ŒåŒºåˆ«åœ¨å¤åˆ¶çš„å±‚çº§ï¼š

|     ç‰¹æ€§     |          æµ…æ‹·è´          |              æ·±æ‹·è´              |
| :----------: | :----------------------: | :------------------------------: |
|   å¤åˆ¶å±‚çº§   |     ä»…å¤åˆ¶ç¬¬ä¸€å±‚å±æ€§     |      é€’å½’å¤åˆ¶æ‰€æœ‰åµŒå¥—çš„å±æ€§      |
| å¼•ç”¨ç±»å‹å¤„ç† | å¤åˆ¶ä¸€ä»½å¼•ç”¨åœ°å€è¿›è¡Œå…±äº« | åˆ›å»ºå‡ºä¸€ä¸ªå…¨æ–°å¯¹è±¡å¼€è¾Ÿä¸€ä¸ªæ–°ç©ºé—´ |
|   ä¿®æ”¹å½±å“   | ä¿®æ”¹åµŒå¥—å¯¹è±¡ä¼šå½±å“åŸå±æ€§ |    ä¿®æ”¹ä»»ä½•å¯¹è±¡ä¸ä¼šå½±å“åŸå±æ€§    |

#### å“ªäº›æ–¹æ³•å¯ä»¥å®ç° æµ…æ‹·è´

- ç›´æ¥èµ‹å€¼ï¼ˆä¸æ˜¯æ‹·è´ï¼Œåªæ˜¯å¼•ç”¨çš„ä¼ é€’ï¼‰

```js
const obj = { a: 1, nested: { b: 2 } };
const _obj = obj; //åªæ˜¯å¼•ç”¨çš„ä¼ é€’
_obj.a = 999;
console.log(obj.a); // 999 åŸå¯¹è±¡è¢«ä¿®æ”¹
```

- Object.assign()

```js
const obj = { a: 1, nested: { b: 2 } };
const _obj = Object.assign({}, obj);
_obj.nested.b = 999;
console.log(obj.nested.b); // 999 æµ…æ‹·è´é™·é˜±
```

- å±•å¼€è¿ç®—ç¬¦

```js
const obj = { a: 1, nested: { b: 2 } };
const _obj = { ...obj };
_obj.nested.b = 666;
console.log(_obj.nested.b); // 666 åŒæ ·å½±å“åŸå¯¹è±¡
```

#### å“ªäº›æ–¹æ³•å¯ä»¥å®ç° æ·±æ‹·è´

- JSON.parse(JSON.stringify()) æœ€å¿«æ·æ–¹å¼

```js
const obj = { a: 1, nested: { b: 2 } };
const deepCopy = { ...obj };
deepCopy.nested.b = 666;
console.log(deepCopy.nested.b); // ä¿æŒåŸå€¼ -> æˆåŠŸæ·±æ‹·è´
```

ä½†æ˜¯è¿™ç§æ–¹æ³•å­˜åœ¨å±€é™æ€§ï¼š

- ä¸¢å¤± undefinedã€functionç­‰ç±»å‹
- æ—¥æœŸå¯¹è±¡ä¼šè¢«è½¬æ¢ä¸ºå­—ç¬¦ä¸²

ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ Lodashçš„ \_.cloneDeep æ–¹æ³•

æ‰‹åŠ¨å®ç°ä¸€ä¸ªæ·±æ‹·è´

```js
function cloneDeep(source: any, map = new WeakMap()) {
    //åŸºç¡€çš„ç±»å‹ç›´æ¥è¿”å›
    if (typeof source !== 'object' || source === null) return source;
    //å¤„ç†å¾ªç¯å¼•ç”¨ï¼Œé¿å…æ— æ•ˆé€’å½’
    if (map.has(source)) return map.get(source);
    //åŠ¨æ€åˆ›å»ºå‰¯æœ¬ï¼Œå¦‚æœæ˜¯æ•°ç»„ -> []
    const target = Array.isArray(source) ? [] : {};
    map.set(source, target)
    //å¼€å§‹é€’å½’æ‹·è´å±æ€§
    for (const key in source) {
        //æ ¹æ®keyæ‹·è´
        if (source.hasOwnProperty(key)) {
            //é€’å½’å¼•ç”¨èµ‹å€¼
            target[key] = cloneDeep(source[key], map);
        }
    }
    //è¿”å›é€’å½’å®Œæˆåçš„æ–°å¯¹è±¡
    return target;
}
```

Q1ï¼šä¸ºä»€ä¹ˆç”¨WeakMap è€Œä¸æ˜¯ Map

> WeakMapæ˜¯å¼±å¼•ç”¨ç±»å‹ï¼Œèƒ½æ›´å¥½çš„å¤„ç†GCæœºåˆ¶ï¼Œé¿å…å†…å­˜æ³„éœ²

> æ›´é€‚åˆä¸´æ—¶å­˜å‚¨ï¼Œæ·±æ‹·è´å®Œæˆåï¼Œèƒ½è‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ•°æ®

### ä½ çŸ¥é“çš„ Promise å’Œ async/await ï¼Ÿ

1. `Promise` æ˜¯ Javascript ä¸­å¤„ç† `å¼‚æ­¥` æ“ä½œçš„ä¸€ä¸ª `å¯¹è±¡`

2. ä»–æœ‰ä¸‰ç§çŠ¶æ€ï¼š

- `pending` -> åˆå§‹åŒ–ï¼ˆæœªå®Œæˆä¹Ÿæœªç»“æŸï¼‰çŠ¶æ€
- `fulfilled` -> æ“ä½œå®Œæˆ
- `rejected` -> æ“ä½œå¤±è´¥

3. é“¾å¼è°ƒç”¨ï¼šé€šè¿‡ `then()`ã€`catch()`ã€`finally()` å¤„ç†ç»“æœï¼Œæˆ–è€…æ•è·å¼‚å¸¸ï¼Œé¿å… `å›è°ƒåœ°ç‹±`

#### Q1ï¼šå›è°ƒåœ°ç‹±æ˜¯ä»€ä¹ˆï¼Ÿ

> æŒ‡çš„æ˜¯åœ¨ Javascript ä¸­ å¤šå±‚åµŒå¥—çš„å›è°ƒå‡½æ•°ï¼Œæ¯”å¦‚å¤„ç†å¤šé¡ºåºä¾èµ–çš„å¼‚æ­¥æ“ä½œ

#### Q2ï¼šä¸ºä»€ä¹ˆä¼šå‡ºç°å›è°ƒåœ°ç‹±ï¼Ÿ

> ä¸€èˆ¬åœ¨è¿›è¡Œè®¡æ—¶ã€ç½‘ç»œè¯·æ±‚ç­‰æ“ä½œæ—¶éœ€è¦å›è°ƒå‡½æ•°æ¥å¤„ç†æœ€ç»ˆç»“æœï¼Œä½†æ˜¯ç½‘ç»œè¯·æ±‚å¯èƒ½ä¸æ­¢ä¸€ä¸ªï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå‡ºç°
> A å®Œæˆæ‰§è¡Œå æ‰§è¡Œ Bï¼ŒB æ‰§è¡Œå®Œåæ‰§è¡Œ Cï¼Œå¼€å‘è€…ä¸å¾—ä¸å°†ç»“æœä¾èµ–è¿›è¡ŒåµŒå¥—ï¼Œä¿è¯æ¯ä¸ªå›è°ƒéƒ½èƒ½å¾€ä¸‹é¡ºå»¶ã€‚
> é€ æˆä»£ç å¯è¯»æ€§å·®ï¼Œç»´æŠ¤æ€§å·®ï¼Œéš¾ä»¥æ‰©å±•å’Œç®¡ç†

#### Q3ï¼šæœ‰å“ªäº›å…¸å‹çš„å›è°ƒåœ°ç‹±åœºæ™¯ï¼Ÿ

åœ¨è·å–å•†å“ç›¸å…³æ•°æ®æ—¶ï¼š

- ç”¨æˆ· id -> è®¢å• id
- è®¢å• id -> å•†å“ id
- å•†å“ id -> å•†å“è¯¦æƒ…

å› ä¸º `Promise` å®é™…ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼Œé‚£ä¹ˆæ—¢ç„¶æ˜¯å‡½æ•°å¯¹è±¡ï¼Œå°±å­˜åœ¨è‡ªå·±çš„ `prototype` å±æ€§
è€Œ thenã€catchã€finally éƒ½å±äº prototype çš„æ–¹æ³•

```js
const fetchData = () => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      const num = Math.random();
      num > 0.5 ? resolve("success") : reject("fail");
    }, 1000);
  });
};
fetchData()
  .then(data => console.log(data))
  .catch(error => console.log(error));
```

#### Q4ï¼šèƒ½è¯¦ç»†è¯´è¯´ é“¾å¼è°ƒç”¨å—ï¼Ÿ

> æ ¹æ®ä¸Šæ–‡æ‰€è¿°ï¼Œ.then() æ–¹æ³•å¯ä»¥æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ Promise æˆåŠŸå…‘ç°çš„å›è°ƒå‡½æ•°ï¼Œä¸€ä¸ªæ˜¯ Promise è¢«æ‹’ç»çš„å›è°ƒå‡½æ•°ã€‚
> ä½†æ˜¯ .then() æ–¹æ³•è¢«æ‰§è¡Œååˆä¼šè¿”å›ä¸€ä¸ªæ–°ç”Ÿæˆçš„ Promise å¯¹è±¡ï¼ŒåŒæ ·å¯ä»¥ç»§ç»­è°ƒç”¨ .then æ–¹æ³•ã€‚è¿™ç§ç°è±¡å°±åƒ "ä¿„ç½—æ–¯" å¥—å¨ƒã€‚
> ä½†æ˜¯æ¯ä¸ª .then() æ–¹æ³•çš„å¤„ç†å¯¹é“¾å¼è°ƒç”¨ä¸­çš„ä¸‹æ¸¸åˆéå¸¸é‡è¦ï¼Œæ‰€ä»¥ .catch() æ–¹æ³•å°±æ˜¯å¤„ç†ç”¨äºé’ˆå¯¹æœªè¢«å…‘ç°çš„ Promiseï¼Œå¹¶ä¸”è¿™ä¸ª
> .catch() æ–¹æ³•æœ€åå¼æ”¾åœ¨é“¾å¼è°ƒç”¨çš„æœ€åå»å¤„ç†ä»¥ä¿è¯æ•´ä¸ªé“¾å¼çš„å®Œæ•´æ€§

#### Q5ï¼šè°ˆè°ˆå¦‚ä½•é€šè¿‡ Promise è¿›è¡Œå¹¶å‘æ§åˆ¶

> é¦–å…ˆå¿…é¡»è¦æ³¨æ„çš„æ˜¯ï¼ŒPromise æ— æ³•åšåˆ°çœŸæ­£æ„ä¹‰ä¸Šçš„ å¹¶å‘æ‰§è¡Œï¼ï¼ï¼

ä¸ºä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿ

> åŸå› å¾ˆç®€å•ï¼ŒJavascript æœ¬è´¨æ˜¯ å•çº¿ç¨‹ï¼Œå°½ç®¡æ§åˆ¶æƒäº¤ç»™ å¤šä¸ªä¸åŒçš„Promiseåšå¤„ç†ï¼Œä½†æ˜¯æœ¬è´¨ä¸Šä¾ç„¶æ˜¯ä¸€ä¸ªä»»åŠ¡ä¼šè¢«æ‰§è¡Œã€‚åªæ˜¯çœ‹èµ·æ¥æ˜¯å¹¶å‘

ä½†æ˜¯ Promise ä¹Ÿæä¾›äº† å››ç§é™æ€æ–¹æ³• å¤„ç†å¼‚æ­¥ä»»åŠ¡çš„å¹¶å‘

- Promise.all()

> å¯ä¼ å…¥å¤šä¸ªå¯è¿­ä»£çš„ Promiseï¼Œå¹¶ä¸”å¦‚æœæœ‰å…¶ä¸­ä¸€ä¸ªæ— æ³•å…‘ç°ï¼Œåˆ™å…¨éƒ¨æ— æ•ˆ

```js
const promise1 = Promise.resolve(6);
const promise2 = 36;
const promise3 = new Promise((resolve, reject) => {
  setTimeout(resolve, 100, "foo");
});
const allPromise = Promise.all([promise1, promise2, promise3]).then(values => {
  console.log(values);
});
// [6, 36, 'foo']
```

- Promise.allSettled()

> å¯ä¼ å…¥å¤šä¸ªå¯è¿­ä»£çš„ Promiseï¼Œå½“ä¸€ä¸ª Promise è¢«æ•²å®šï¼ˆè¦ä¹ˆå…‘ç°ï¼Œè¦ä¹ˆæ‹’ç»ï¼‰éƒ½ä¼šè¿”å›

```js
const promise1 = Promise.resolve(1);
const promise2 = new Promise((resolve, reject) => {
  setTimeout(reject, 100, "foo");
});

const allSetPromise = [promise1, promise2];
const result = Promise.allSettled(allSetPromise).then(values => {
  console.log(values);
});
// [
//   {status: 'fulfilled', value: 1},
//   {status: 'rejected', reason: 'foo'}
// ]
```

- Promise.any()

> å½“ä¼ å…¥å¤šä¸ªå¯è¿­ä»£å¯¹è±¡çš„ Promiseï¼Œè¿”å›å…¶ä¸­ä¸€ä¸ªè¢«å…‘ç°çš„å€¼ï¼Œå¹¶ä¸”è¿”å›ç¬¬ä¸€ä¸ªæˆåŠŸè¢«å…‘ç°çš„å€¼

- Promise.race()

> å½“ä¼ å…¥å¤šä¸ªå¯è¿­ä»£å¯¹è±¡çš„ Promiseï¼Œä¹Ÿæ˜¯è¿”å›ä¸€ä¸ªï¼Œé‚£ä¸ªè¢«å…‘ç°çš„å¿«å°±è¿”å›å“ªä¸ª

```js
const promise2 = new Promise((resolve, reject) => {
  setTimeout(resolve, 200, "success1");
});
const promise3 = new Promise((resolve, reject) => {
  setTimeout(resolve, 100, "success2");
});
const allSetPromise = [promise2, promise3];
const allPromise = Promise.race(allSetPromise).then(values => {
  console.log(values);
});
// success2
```

#### async å’Œ awaitå‘¢ï¼Ÿ

> ç®€å•æ¥è¯´ ä»–ä»¬æ˜¯ Promise çš„è¯­æ³•ç³–

`async`

ç»‘å®šç»™å·²å®šçš„æ–°çš„å¼‚æ­¥å‡½æ•°ï¼Œå‡½æ•°ä½“å†…å¯ä»¥ä½¿ç”¨ `await` è¿™è®©æˆ‘ä»¬æ›´åŠ æ–¹ä¾¿çš„å¤„ç† Promiseï¼Œæ¯æ¬¡å¼‚æ­¥è°ƒç”¨æ—¶ï¼Œå®ƒéƒ½è¿”å›ä¸€ä¸ªæ–°çš„ Promise
é¿å…äº†æ˜¾ç¤ºçš„é…ç½® Promise é“¾ã€‚

å¯ä»¥é€šè¿‡ `async function` è¡¨è¾¾å¼æ¥å®šä¹‰å¼‚æ­¥å‡½æ•°

```js
const fun1 = () => {
  return new Promise(resolve => {
    setTimeout(() => {
      console.log("resolved");
    }, 2000);
  });
};
const fun2 = async () => {
  const response = await fun1();
  console.log(response); //resolved
};
fun2();
```

`await`

await å°±æ˜¯ç­‰å¾…çš„æ„æ€ ä»…åœ¨å¼‚æ­¥å‡½æ•°æˆ–è€…æ¨¡å—é¡¶çº§ä¸­ä½¿ç”¨ï¼Œæ— æ³•åœ¨è„±ç¦» asyncæƒ…å†µä¸‹ä½¿ç”¨ï¼Œå®ƒä¸€èˆ¬ä½œç”¨äº `å‡½æ•°ä½“` ä¸­

> å¼‚æ­¥å‡½æ•°ä½“å¯ä»¥çœ‹ä½œç”±é›¶ä¸ª æˆ–è€… å¤šä¸ª await åˆ†å‰²å¼€æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ä»å‡½æ•°é¡¶çº§åˆ°æ‰§è¡Œåˆ°ç¬¬ä¸€ä¸ª awaitï¼Œæ­¤è¿‡ç¨‹éƒ½æ˜¯åŒæ­¥çš„è¿è¡Œçš„

`await` è¡¨è¾¾å¼åéƒ½ä¼šè¢«è®¤ä¸ºè·Ÿç€ä¸€ä¸ª `.then()` çš„å›è°ƒï¼Œæ ¹æ®è¿™ä¸ªç‰¹æ€§ï¼Œæ¯ä¸ª Promise é“¾éƒ½å¯ä»¥æ ¹æ®æƒ…å†µè¿›è¡Œ `é“¾é‡æ„`

å¼‚æ­¥å‡½æ•°å¦‚æœè¿”å›çš„çœ‹èµ·æ¥ä¸åƒæ˜¯ Promiseï¼Œé‚£ä¹ˆå°†ä¼šéšå¼çš„é’ˆå¯¹è¿™ä¸ªå‡½æ•°åœ¨å¤–éƒ¨åŒ…æ‹¬ä¸€å±‚ Promise è¿”å›

ä½†æ˜¯åªæ˜¯çœ‹èµ·æ¥åŒ…æ‹¬äº†ä¸€å±‚ Promise ä½†æ˜¯å®ƒä»¬å¹¶ä¸ä¼šå®Œå…¨ç›¸ç­‰

```js
const p = new Promise(resolve => {
  resolve(1);
});

const asyncReturn = () => {
  return p;
};

const basicReturn = () => {
  return Promise.resolve(p);
};
console.log(p === basicReturn()); //true
console.log(p === asyncReturn()); //false
```

### ä½ å¦‚ä½•è¿›è¡Œå¤§æ–‡ä»¶çš„ä¸Šä¼ ï¼Ÿ

#### åˆ‡ç‰‡åˆ†å—ä¸Šä¼ 

å‡è®¾ä¸€ä¸ª100M æ–‡ä»¶ä¸Šä¼ éœ€è¦ 2åˆ†é’Ÿï¼Œå½“ä¸€ä¸ªæ–‡ä»¶å¾ˆå¤§æ˜¯ï¼Œæ¯”å¦‚ 1Gï¼Œè¿™æ—¶å€™å¦‚æœç›´æ¥å°†æ•´ä¸ªæ–‡ä»¶ä¸Šä¼ å°±éœ€è¦ 20åˆ†é’Ÿï¼Œè¿™ç§ä¼šé€ æˆç”¨æˆ·ä½“éªŒä¼šå¾ˆä¸å¥½ã€‚
æ‰€ä»¥åœ¨å¤§æ–‡ä»¶ä¸Šä¼ çš„åœºæ™¯ä¸‹ï¼Œéœ€è¦åšä¸€äº›ä¼˜åŒ–ã€‚

æ¯”å¦‚æŠŠ 1G çš„æ–‡ä»¶ï¼Œæ‹†åˆ†æˆ 10ä¸ª 100Mçš„å°æ–‡ä»¶ï¼Œç„¶åè¿™äº›æ–‡ä»¶é€šè¿‡å¹¶è¡Œçš„æ–¹å¼ä¸Šä¼ ï¼Œç­‰ 10ä¸ª å°æ–‡ä»¶ä¸Šä¼ å®Œæˆåï¼Œ
å†é€šè¿‡æœåŠ¡ç«¯æ–‡ä»¶åˆå¹¶çš„æ¥å£ï¼Œå°†åŸæ¥åˆ†ç‰‡çš„æ–‡ä»¶è¿›è¡Œæ•´åˆæˆä¸€ä¸ªæ–‡ä»¶

è¿™å°±æ˜¯å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ çš„æ–¹æ¡ˆ

#### File å’Œ Blob

> Fileæ˜¯ç»§æ‰¿è‡ªBlobï¼Œæˆ–è€…è¯´ File å¯ä»¥é€šè¿‡è°ƒç”¨ Blob çš„ç‰¹æ®Šæ–¹æ³•å»å°† Fileç±»å‹ çš„æ–‡ä»¶è½¬æ¢ä¸º Blobçš„äºŒè¿›åˆ¶æµ æ–‡ä»¶ç„¶åå†é€šè¿‡FormDataçš„å½¢å¼è¿›è¡Œä¼ è¾“

`Blob`å†…ç½®äº†ä¸€ä¸ª `slice` æ–¹æ³•ï¼Œå®ƒä¼šåˆ›å»ºå¹¶ä¸”è¿”å›ä¸€ä¸ªæ–°çš„ Blobå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«äº†è°ƒç”¨ blob çš„å­é›†ï¼Œä¹Ÿå°±æ˜¯è¯´Fileç±»å‹æ–‡ä»¶å¯ä»¥é€šè¿‡ slice æ–¹æ³•
å°† Fileæ–‡ä»¶ è½¬æ¢ä¸º blobçš„äºŒè¿›åˆ¶æµæ–‡ä»¶

```ts
const splitFile = (file: File) => {
  const chunkSize = 5 * 1024 * 1024; //æ¯å— 10mb
  let chunks = []; //å®šä¹‰ä¸€ä¸ªåˆå§‹åŒ–çš„ chunks
  let startSize = 0; //è®¡ç®—åˆå§‹åŒ–çš„æ–‡ä»¶å¤§å°
  while (startSize < file.size) {
    //ç¡®ä¿åˆ†å‰²å‡ºæ¥çš„æ–‡ä»¶å¤§å°ä¸ä¼šè¶…è¿‡æ€»æ–‡ä»¶
    const end = Math.min(startSize + chunkSize, file.size);
    //å°†åˆ†å‰²å¥½çš„æ·»åŠ åˆ° chunks é›†åˆ
    chunks.push(file.slice(startSize, end)); //å¼€å§‹åˆ†å‰² file å¹¶ è½¬æ¢ä¸º Blob
    //ç´¯è®¡æ¯æ¬¡æœ€åæ·»åŠ çš„æ–‡ä»¶å¤§å°
    startSize = end;
  }
  return chunks;
};

const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {
  const file: File | undefined = e.target.files?.[0];
  const chunks = splitFile(file!);
  //é˜²æ­¢æ–‡ä»¶åå†²çª
  const randomStr = Math.random().toString().slice(2, 7);
  let tasks: Promise<void>[] = [];
  //å¾ªç¯æ•´ä¸ªæ–‡ä»¶
  chunks.map((chunk, index) => {
    const data = new FormData();
    data.set("name", randomStr + "_" + file?.name + "-" + index);
    data.append("files", chunk);
    tasks.push(axios.post("http://192.168.2.xxx:3001/user/upload", data));
  });
  //å¹¶è¡Œä¸Šä¼ 
  await Promise.all(tasks);
  //ä¸Šä¼ å®Œæ¯•åï¼Œæ‰§è¡Œæ–‡ä»¶åˆå¹¶æ“ä½œï¼ŒæœåŠ¡ç«¯ä¼šè‡ªåŠ¨åˆ é™¤åŸæ¥ä¸Šä¼ çš„åˆ‡ç‰‡å†è¿›è¡Œæ•´åˆ
  axios
    .get(
      "http://192.168.2.xxx:3001/user/merge?name=" +
        randomStr +
        "_" +
        file?.name
    )
    .then(res => {
      console.log("res", res);
    });
};
```

åç«¯ä»£ç ï¼ˆè¿™é‡Œæ˜¯ NestJsï¼‰

```ts
// ä¸Šä¼ æ¥å£
@Post('upload')
@UseInterceptors(FilesInterceptor('files', 20, {
  dest: 'uploads1'
}))
uploadFiles(@UploadedFiles() files: Array<Express.Multer.File>, @Body() body: { name: string }) {
  console.log('body', body)
  console.log('files', files)
  const fileName = body.name.match(/(.+)\-\d+$/)[1];
  const chunkDir = 'uploads1/chunks_' + fileName;
  if (!fs.existsSync(chunkDir)) {
    fs.mkdirSync(chunkDir);
  }
  fs.cpSync(files[0].path, chunkDir + '/' + body.name);
  fs.rmSync(files[0].path);
}

// åˆå¹¶
@Get('merge')
merage(@Query('name') name: string) {
  const chunkDir = 'uploads1/chunks_' + name;
  const files = fs.readdirSync(chunkDir);
  let startPos = 0;
  let count = 0;
  files.map(file => {
    const filePath = chunkDir + '/' + file;
    const stream = fs.createReadStream(filePath);
    stream.pipe(fs.createWriteStream('uploads1' + name, {
      start: startPos
    })).on('finish', () => {
      count++;
      if (count === files.length) {
        fs.rm(chunkDir, {
          recursive: true
        }, () => {
        });
      }
    })
    startPos += fs.statSync(filePath).size;
  })
}
```

### å…³äº OSS æ–‡ä»¶ä¸Šä¼ äº†è§£å—ï¼Ÿ

> OSSæ˜¯é˜¿é‡Œäº‘æä¾›çš„ä¸€å¥—æ–‡ä»¶äº‘å¯¹è±¡å­˜å‚¨åº“ï¼Œä¼ ç»Ÿçš„æ–‡ä»¶ä¸Šä¼ æ˜¯ç›´æ¥å°†æ–‡ä»¶ä»¥ ç›®å½• -> æ–‡ä»¶ å½¢å¼ä¼ é€’ç»™æœåŠ¡ç«¯ï¼Œæ ¹æ®æœåŠ¡ç«¯åˆ›å»ºçš„ç›®å½•è¿›è¡Œå­˜å‚¨

Qï¼šåœºæ™¯åº”ç”¨

> åœ¨å¤šæ–‡ä»¶å­˜å‚¨åŠŸèƒ½ä¸­ï¼Œå¯ä»¥å°†å¤§é‡æ–‡ä»¶å­˜å‚¨åˆ°OSSäº‘å¯¹è±¡å­˜å‚¨åº“ä¸­ï¼Œå®ƒä¸å†æ˜¯ä»¥ ç›®å½• -> æ–‡ä»¶å½¢å¼çš„å­˜å‚¨

å®ƒæ˜¯åˆ†æˆå¤šä¸ª `bucket` çš„ç»“æ„å½¢å¼å­˜æ”¾ä¸åŒçš„æ–‡ä»¶ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®æƒ…å†µå­˜å‚¨

æ¯”å¦‚ `bucket-1`ï¼Œ`bucket-2`ï¼Œå¯ä»¥ç†è§£ä¸ºæ¯ä¸€ä¸ª bucket éƒ½æ˜¯ä¸€ä¸ª â€æ¡¶â€œ

#### OSS å¤§è‡´åˆ†ä¸ºä¸‰ç§å­˜å‚¨æ–¹å¼

- å—å­˜å‚¨ï¼šç›¸å½“äºæŠŠç£ç›˜ç»™ä½ ï¼Œä½ è‡ªå·±æ ¼å¼åŒ–ï¼Œå®¹é‡æœ‰é™
- æ–‡ä»¶å­˜å‚¨ï¼šä»¥ç›®å½•æ–‡ä»¶å±‚æ¬¡ç»“æ„å­˜å‚¨ï¼Œä½ å¯ä»¥è‡ªå·±ä¸Šä¼ æˆ–è€…ä¸‹å‘¨ï¼Œå®¹é‡æœ‰é™
- å¯¹è±¡å­˜å‚¨ï¼šKey-value å½¢å¼ï¼Œåˆ†å¸ƒå¼å®ç°çš„ï¼Œå®¹é‡æ— é™ï¼ˆç»å¯¹å¤šæ•°æƒ…å†µä½¿ç”¨è¿™ç§æ–¹å¼ï¼‰
